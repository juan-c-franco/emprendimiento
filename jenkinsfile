currentBuild.displayName = "Emprendimiento-#"+currentBuild.number
pipeline {
    agent any
    stages {
       def sonarProjectKey = "emprendimiento"
       def sonarProjectName = "emprendimiento"
       def sonarSources='./emprendimiento-business/src,./emprendimiento-persistence/src,./emprendimiento-web/src'
       def sonarExclusions='./emprendimiento-business/src/test/*,./emprendimiento-persistence/src/test/*,./emprendimiento-web/src/test/*,./emprendimiento-web/src/main/resources/*,./emprendimiento-web/src/main/webapp/*'
       def sonarTypescriptLcovReportPath='./coverage/lcov.info'
        stage("Git Checkout") {
            steps {
                git credentialsId: 'juancfranco', url: 'https://github.com/yonki/emprendimiento.git'
            }
        }
        stage("Maven Build") {
            steps {
                bat """
                mvn -s mvn-settings.xml -DskipTests sonar:sonar \
                                -Dsonar.projectKey=${sonarProjectKey} \
                                -Dsonar.projectName=${sonarProjectName} \
                                -Dsonar.sources=${sonarSources} \
                                -Dsonar.test=.\
                                -Dsonar.exclusions=**/assets/**,**/test/**,node_modules\\**,dist\\**,coverage\\**,src\\app\\resources\\**,src\\app\\config\\**,src\\app\\testClass\\**
                                """
            }
        }
	    stage('Evaluate Quality Gate') {
            def qg = waitForQualityGate()
            if (qg.status != 'OK') {
               error "Pipeline aborted due to quality gate failure: ${qg.status}"
            }
        }
    }  
}
